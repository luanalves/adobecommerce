<?php
/**
 * Website switcher template for cross-domain authentication
 *
 * @var \TheDevKitchen\JwtCrossDomainAuth\Block\Switcher $block
 */
?>
<?php $websites = $block->getWebsites(); ?>
<?php if (!empty($websites) && $block->isEnabled() && $block->isCustomerLoggedIn()) : ?>
    <div class="switcher website switcher-website" data-ui-id="website-switcher" id="switcher-website">
        <strong class="label switcher-label"><span><?= $block->escapeHtml(__('Website')) ?></span></strong>
        <div class="actions dropdown options switcher-options">
            <div class="action toggle switcher-trigger"
                 id="switcher-website-trigger"
                 data-mage-init='{"dropdown":{}}'
                 data-toggle="dropdown"
                 data-trigger-keypress-button="true">
                <strong class="current-website">
                    <span><?= $block->escapeHtml(__('Switch Store')) ?></span>
                </strong>
            </div>
            <ul class="dropdown switcher-dropdown" data-target="dropdown">
                <?php foreach ($websites as $website) : ?>
                    <li class="website-name">
                        <span><?= $block->escapeHtml($website['name']) ?></span>
                        <ul class="stores-list">
                            <?php foreach ($website['stores'] as $store) : ?>
                                <li class="view-<?= $block->escapeHtml($store['code']) ?> switcher-option">
                                    <a href="#" 
                                       class="cross-domain-link" 
                                       data-website-id="<?= $block->escapeHtml($website['id']) ?>"
                                       data-store-id="<?= $block->escapeHtml($store['id']) ?>"
                                       data-domain="<?= $block->escapeHtml($store['domain']) ?>">
                                        <?= $block->escapeHtml($store['name']) ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                        </ul>
                    </li>
                <?php endforeach; ?>
            </ul>
        </div>
    </div>
<?php endif; ?>